{% extends 'professional_base.html' %}
{% load static %}

{% block title %}Medical Donor Dashboard - WeDonate Professional Platform{% endblock %}

{% block navigation %}
<li class="nav-item">
    <a class="nav-link" href="{% url 'donor-landing-page' %}">
        <i class="fas fa-home me-1"></i>Dashboard
    </a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{% url 'donor-home' %}">
        <i class="fas fa-history me-1"></i>History
    </a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{% url 'book-appointment' %}">
        <i class="fas fa-calendar-plus me-1"></i>Appointments
    </a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{% url 'new-donation-request' %}">
        <i class="fas fa-plus-circle me-1"></i>New Donation
    </a>
</li>
<li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
        <i class="fas fa-user-cog me-1"></i>Account
    </a>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="{% url 'donor-profile-update' %}">
            <i class="fas fa-user me-2"></i>Profile Settings
        </a></li>
        <li><a class="dropdown-item" href="{% url 'donor-profile-update' %}">
            <i class="fas fa-key me-2"></i>Change Password
        </a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{% url 'donor-logout' %}">
            <i class="fas fa-sign-out-alt me-2"></i>Log Out
        </a></li>
    </ul>
</li>
{% endblock %}

{% block hero_section %}
<section class="hero-section" style="min-height: 60vh; padding-top: 120px;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="hero-title mb-3">Medical Donor Dashboard</h1>
                <p class="hero-description">Comprehensive overview of your medical donations and health records. Track your life-saving contributions and manage appointments.</p>
            </div>
            <div class="col-lg-4 text-end">
                <div class="d-grid gap-2">
                    <a href="{% url 'new-donation-request' %}" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-plus-circle me-2"></i>New Donation Request
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<div class="container" style="margin-top: -80px; position: relative; z-index: 10;">
    <!-- Medical Summary Cards -->
    <div class="row g-4 mb-5">
        <div class="col-lg-3 col-md-6">
            <div class="professional-card text-center p-4">
                <div class="mb-3">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                         style="width: 60px; height: 60px;">
                        <i class="fas fa-hand-holding-heart" style="font-size: 1.5rem;"></i>
                    </div>
                </div>
                <h3>{{ donationrequests|length }}</h3>
                <p class="text-muted mb-0">Total Donations</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="professional-card text-center p-4">
                <div class="mb-3">
                    <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                         style="width: 60px; height: 60px;">
                        <i class="fas fa-check-circle" style="font-size: 1.5rem;"></i>
                    </div>
                </div>
                <h3>
                    {% with approved_count=0 %}
                        {% for dreq in donationrequests %}
                            {% if dreq.donation_status == 'Approved' %}
                                {% with approved_count=approved_count|add:1 %}{% endwith %}
                            {% endif %}
                        {% endfor %}
                        {{ approved_count }}
                    {% endwith %}
                </h3>
                <p class="text-muted mb-0">Approved Donations</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="professional-card text-center p-4">
                <div class="mb-3">
                    <div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                         style="width: 60px; height: 60px;">
                        <i class="fas fa-clock" style="font-size: 1.5rem;"></i>
                    </div>
                </div>
                <h3>
                    {% with pending_count=0 %}
                        {% for dreq in donationrequests %}
                            {% if dreq.donation_status == 'Pending' %}
                                {% with pending_count=pending_count|add:1 %}{% endwith %}
                            {% endif %}
                        {% endfor %}
                        {{ pending_count }}
                    {% endwith %}
                </h3>
                <p class="text-muted mb-0">Pending Reviews</p>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="professional-card text-center p-4">
                <div class="mb-3">
                    <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                         style="width: 60px; height: 60px;">
                        <i class="fas fa-heartbeat" style="font-size: 1.5rem;"></i>
                    </div>
                </div>
                <h3>Lives Saved</h3>
                <p class="text-muted mb-0">Impact Tracking</p>
            </div>
        </div>
    </div>
    
    <!-- Medical Donation History Table -->
    <div class="row">
        <div class="col-12">
            <div class="professional-table">
                <div class="d-flex justify-content-between align-items-center p-4 border-bottom">
                    <h4 class="mb-0">
                        <i class="fas fa-clipboard-list me-2"></i>
                        Medical Donation Records
                    </h4>
                    <div class="d-flex gap-2">
                        <a href="{% url 'new-donation-request' %}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>New Request
                        </a>
                        <a href="{% url 'book-appointment' %}" class="btn btn-outline-primary">
                            <i class="fas fa-calendar-plus me-2"></i>Book Appointment
                        </a>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table mb-0">
                        <thead>
                            <tr>
                                <th><i class="fas fa-hashtag me-2"></i>Medical ID</th>
                                <th><i class="fas fa-lungs me-2"></i>Organ Type</th>
                                <th><i class="fas fa-tint me-2"></i>Blood Group</th>
                                <th><i class="fas fa-heart-pulse me-2"></i>Donation Status</th>
                                <th><i class="fas fa-calendar-check me-2"></i>Appointment Status</th>
                                <th><i class="fas fa-clock me-2"></i>Request Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dreq in donationrequests %}
                            <tr>
                                <td class="fw-bold">#{{dreq.id}}</td>
                                <td>
                                    <span class="status-badge" style="background: var(--primary); color: white;">
                                        {{dreq.organ_type}}
                                    </span>
                                </td>
                                <td>
                                    <span class="status-badge" style="background: var(--danger); color: white;">
                                        {{dreq.blood_type}}
                                    </span>
                                </td>
                                <td>
                                    {% if dreq.donation_status == 'Approved' %}
                                        <span class="status-badge status-approved">
                                            <i class="fas fa-check-circle me-1"></i>{{dreq.donation_status}}
                                        </span>
                                    {% elif dreq.donation_status == 'Pending' %}
                                        <span class="status-badge status-pending">
                                            <i class="fas fa-clock me-1"></i>{{dreq.donation_status}}
                                        </span>
                                    {% else %}
                                        <span class="status-badge status-denied">
                                            <i class="fas fa-times-circle me-1"></i>{{dreq.donation_status}}
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if dreq.appointment_status == 'Approved' %}
                                        <span class="status-badge status-approved">
                                            <i class="fas fa-check-circle me-1"></i>{{dreq.appointment_status}}
                                        </span>
                                    {% elif dreq.appointment_status == 'Pending' %}
                                        <span class="status-badge status-pending">
                                            <i class="fas fa-clock me-1"></i>{{dreq.appointment_status}}
                                        </span>
                                    {% else %}
                                        <span class="status-badge status-denied">
                                            <i class="fas fa-times-circle me-1"></i>{{dreq.appointment_status}}
                                        </span>
                                    {% endif %}
                                </td>
                                <td>{{dreq.datetime|date:"M d, Y"}}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-5">
                                    <div class="text-center">
                                        <i class="fas fa-heart fa-4x text-muted mb-3" style="opacity: 0.3;"></i>
                                        <h5 class="text-muted">No Donation Records Found</h5>
                                        <p class="text-muted mb-4">Start your life-saving journey by making your first donation request.</p>
                                        <a href="{% url 'new-donation-request' %}" class="btn btn-primary">
                                            <i class="fas fa-plus-circle me-2"></i>Make Your First Donation
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Medical Support Section -->
<section class="py-5 mt-5 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h3 class="mb-3">Need Medical Assistance?</h3>
                <p class="lead mb-0">Our certified medical professionals are available 24/7 to assist with your donation journey and answer any health-related questions.</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="tel:+18006332273" class="btn btn-primary btn-lg">
                        <i class="fas fa-phone me-2"></i>Call Medical Support
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize professional dashboard features
        
        // Add smooth animations to stat cards
        const statCards = document.querySelectorAll('.professional-card h3');
        statCards.forEach(card => {
            const finalNumber = parseInt(card.textContent);
            if (!isNaN(finalNumber)) {
                animateCounter(card, finalNumber);
            }
        });
        
        // Enhanced table interactions
        const tableRows = document.querySelectorAll('tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.backgroundColor = 'rgba(44, 90, 160, 0.05)';
                this.style.transform = 'scale(1.01)';
            });
            
            row.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '';
                this.style.transform = 'scale(1)';
            });
        });
        
        // Professional notification system
        showWelcomeMessage();
    });
    
    // Counter animation for statistics
    function animateCounter(element, target) {
        let current = 0;
        const increment = Math.max(1, Math.ceil(target / 30));
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            element.textContent = current;
        }, 50);
    }
    
    // Welcome message for professional dashboard
    function showWelcomeMessage() {
        // Check if it's first visit today
        const today = new Date().toDateString();
        const lastVisit = localStorage.getItem('lastDashboardVisit');
        
        if (lastVisit !== today) {
            setTimeout(() => {
                if (window.ProfessionalPlatform && window.ProfessionalPlatform.showAlert) {
                    window.ProfessionalPlatform.showAlert(
                        'Welcome to your Medical Donor Dashboard. All systems are operational and your medical data is secure.',
                        'success',
                        4000
                    );
                }
                localStorage.setItem('lastDashboardVisit', today);
            }, 1000);
        }
    }
    
    // Professional data refresh functionality
    function refreshMedicalData() {
        const refreshBtn = document.createElement('button');
        refreshBtn.className = 'btn btn-outline-primary btn-sm';
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt me-1"></i>Refresh Data';
        refreshBtn.style.position = 'fixed';
        refreshBtn.style.bottom = '20px';
        refreshBtn.style.left = '20px';
        refreshBtn.style.zIndex = '1000';
        
        refreshBtn.addEventListener('click', function() {
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Refreshing...';
            this.disabled = true;
            
            // Simulate data refresh
            setTimeout(() => {
                location.reload();
            }, 1500);
        });
        
        document.body.appendChild(refreshBtn);
    }
    
    // Initialize refresh functionality
    refreshMedicalData();
</script>
{% endblock %}
