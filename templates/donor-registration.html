{% extends 'professional_base.html' %}
{% load static %}

{% block title %}Medical Donor Registration - WeDonate Professional Platform{% endblock %}

{% block extra_nav %}
<a class="nav-link text-white" href="{% url 'wedonate' %}">
    <i class="fas fa-home me-1"></i>
    Home
</a>
<a class="nav-link text-white" href="{% url 'donor-login' %}">
    <i class="fas fa-sign-in-alt me-1"></i>
    Login
</a>
{% endblock %}

{% block content %}
<!-- Professional Hero Section -->
<section class="professional-hero-small">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="text-white mb-3">
                    <i class="fas fa-user-plus me-3"></i>
                    Medical Donor Registration
                </h1>
                <p class="text-white-75 fs-5">Join our professional medical platform and start your journey to save lives</p>
            </div>
            <div class="col-lg-4 text-end">
                <div class="professional-badge">
                    <i class="fas fa-heart me-2"></i>
                    Life Saver Network
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Professional Registration Form -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-7 col-md-8">
                <div class="form-3d">
                    <div class="text-center mb-4">
                        <div class="professional-icon-large mb-3" aria-hidden="true">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h1 id="registration-heading" class="text-primary mb-2">Medical Donor Registration</h1>
                        <p class="text-muted fs-6">Create your account to join our professional medical donor network</p>
                    </div>
                    
                    <form method="POST" action="{% url 'donor-register' %}" class="professional-form" aria-labelledby="registration-heading" novalidate>
                        {% csrf_token %}
                        
                        {% if error %}
                        <div class="alert alert-danger professional-alert" role="alert" aria-live="polite">
                            <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
                            {{ error }}
                        </div>
                        {% endif %}
                        
                        <!-- Personal Information -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="donor_name" class="professional-label">
                                        <i class="fas fa-user me-2" aria-hidden="true"></i>
                                        Full Name <span aria-label="required">*</span>
                                    </label>
                                    <input type="text" name="donor_name" class="form-control-3d" id="donor_name"
                                           placeholder="Enter your full name" required
                                           aria-describedby="donor_name-help"
                                           aria-invalid="false"
                                           autocomplete="name">
                                    <div id="donor_name-help" class="form-text sr-only">Enter your legal full name as it appears on official documents</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="email" class="professional-label">
                                        <i class="fas fa-envelope me-2"></i>
                                        Email Address <span aria-label="required">*</span>
                                    </label>
                                    <input type="email" name="email" class="professional-input" id="email" 
                                           placeholder="Enter your email address" required
                                           aria-describedby="email-help"
                                           autocomplete="email">
                                    <div id="email-help" class="form-text">We'll use this for important account notifications</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="username" class="professional-label">
                                        <i class="fas fa-at me-2"></i>
                                        Username <span aria-label="required">*</span>
                                    </label>
                                    <input type="text" name="username" class="professional-input" id="username" 
                                           placeholder="Choose a unique username" required
                                           aria-describedby="username-help"
                                           autocomplete="username">
                                    <div id="username-help" class="form-text">Choose a unique identifier for your account</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="date_of_birth" class="professional-label">
                                        <i class="fas fa-calendar me-2"></i>
                                        Date of Birth
                                    </label>
                                    <input type="date" name="date_of_birth" class="professional-input" id="date_of_birth" 
                                           required aria-describedby="dob-help">
                                    <div id="dob-help" class="form-text">Must be 18 or older to register</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Location Information -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="city" class="professional-label">
                                        <i class="fas fa-city me-2"></i>
                                        City
                                    </label>
                                    <input type="text" name="city" class="professional-input" id="city" 
                                           placeholder="Enter your city">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="province" class="professional-label">
                                        <i class="fas fa-map-marker-alt me-2"></i>
                                        State
                                    </label>
                                    <select name="province" class="professional-input" id="province" required>
                                        <option value="" disabled selected>Select State</option>
                                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                        <option value="Assam">Assam</option>
                                        <option value="Bihar">Bihar</option>
                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                        <option value="Goa">Goa</option>
                                        <option value="Gujarat">Gujarat</option>
                                        <option value="Haryana">Haryana</option>
                                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                                        <option value="Jharkhand">Jharkhand</option>
                                        <option value="Karnataka">Karnataka</option>
                                        <option value="Kerala">Kerala</option>
                                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                                        <option value="Maharashtra">Maharashtra</option>
                                        <option value="Manipur">Manipur</option>
                                        <option value="Meghalaya">Meghalaya</option>
                                        <option value="Mizoram">Mizoram</option>
                                        <option value="Nagaland">Nagaland</option>
                                        <option value="Odisha">Odisha</option>
                                        <option value="Punjab">Punjab</option>
                                        <option value="Rajasthan">Rajasthan</option>
                                        <option value="Sikkim">Sikkim</option>
                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                        <option value="Telangana">Telangana</option>
                                        <option value="Tripura">Tripura</option>
                                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                                        <option value="Uttarakhand">Uttarakhand</option>
                                        <option value="West Bengal">West Bengal</option>
                                        <option value="Delhi">Delhi</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="contact_number" class="professional-label">
                                        <i class="fas fa-phone me-2"></i>
                                        Contact Number (+91)
                                    </label>
                                    <input type="tel" name="contact_number" class="professional-input" id="contact_number" 
                                           placeholder="10-digit phone number" maxlength="10" minlength="10" pattern="[0-9]{10}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="country" class="professional-label">
                                        <i class="fas fa-flag me-2"></i>
                                        Country
                                    </label>
                                    <select name="country" class="professional-input" id="country">
                                        <option value="India" selected>India</option>
                                        <option value="USA">United States</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="Canada">Canada</option>
                                        <option value="Australia">Australia</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Password Section -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="password1" class="professional-label">
                                        <i class="fas fa-lock me-2"></i>
                                        Create Password
                                    </label>
                                    <div class="professional-input-group">
                                        <input type="password" name="password" class="professional-input" id="password1" 
                                               placeholder="Create a strong password" minlength="6" 
                                               pattern="(?=.*[a-z])(?=.*\d).{6,}" 
                                               title="Password must contain at least 1 lowercase letter and 1 digit" required>
                                        <button type="button" class="professional-toggle-password" onclick="togglePassword('password1')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        At least 6 characters with lowercase and digit
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="professional-form-group">
                                    <label for="password2" class="professional-label">
                                        <i class="fas fa-lock me-2"></i>
                                        Confirm Password
                                    </label>
                                    <div class="professional-input-group">
                                        <input type="password" class="professional-input" id="password2" 
                                               placeholder="Confirm your password" oninput="checkpassword();" required>
                                        <button type="button" class="professional-toggle-password" onclick="togglePassword('password2')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div id="password-validation-msg" class="mt-2"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="professional-form-group">
                            <button type="submit" id="submit" class="btn-3d w-100" 
                                    aria-describedby="submit-help" data-loading="Creating Account...">
                                <i class="fas fa-user-plus me-2" aria-hidden="true"></i>
                                Register as Medical Donor
                            </button>
                            <div id="submit-help" class="form-text sr-only">Submit the form to create your medical donor account</div>
                        </div>
                        
                        <!-- Login Link -->
                        <div class="text-center">
                            <p class="text-muted mb-0">
                                Already have an account? 
                                <a href="{% url 'donor-login' %}" class="professional-link">
                                    <i class="fas fa-sign-in-alt me-1"></i>
                                    Sign In Here
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
                
            </div>
            
            <!-- Professional Benefits Grid -->
            <div class="col-lg-12 mt-5">
                <div class="text-center mb-4">
                    <h3 class="gradient-text">Why Join Our Medical Network?</h3>
                    <p class="text-muted">Make a difference in the world of medical organ donation</p>
                </div>
                <div class="row g-4">
                    <div class="col-lg-4 col-md-4 col-sm-6">
                        <div class="professional-feature-card text-center h-100 scale-on-hover">
                            <div class="professional-feature-icon professional-feature-icon-danger">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="professional-feature-title">Save Lives</div>
                            <div class="professional-feature-subtitle">Save up to 8 lives with one donation</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6">
                        <div class="professional-feature-card text-center h-100 scale-on-hover">
                            <div class="professional-feature-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="professional-feature-title">Join Community</div>
                            <div class="professional-feature-subtitle">Professional Medical Network</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12">
                        <div class="professional-feature-card text-center h-100 scale-on-hover">
                            <div class="professional-feature-icon professional-feature-icon-accent">
                                <i class="fas fa-medal"></i>
                            </div>
                            <div class="professional-feature-title">Be a Hero</div>
                            <div class="professional-feature-subtitle">Create Lasting Impact</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Password toggle functionality
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const button = field.nextElementSibling;
        const icon = button.querySelector('i');
        
        if (field.type === 'password') {
            field.type = 'text';
            icon.className = 'fas fa-eye-slash';
        } else {
            field.type = 'password';
            icon.className = 'fas fa-eye';
        }
    }
    
    function checkpassword() {
        const password1 = document.getElementById('password1').value;
        const password2 = document.getElementById('password2').value;
        const msgElement = document.getElementById('password-validation-msg');
        
        if (password2 === '') {
            msgElement.innerHTML = '';
            return;
        }
        
        if (password1 === password2) {
            msgElement.innerHTML = '<small class="text-success"><i class="fas fa-check-circle me-1"></i>Passwords match!</small>';
            document.getElementById('submit').disabled = false;
        } else {
            msgElement.innerHTML = '<small class="text-danger"><i class="fas fa-times-circle me-1"></i>Passwords do not match!</small>';
            document.getElementById('submit').disabled = true;
        }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        const password2 = document.getElementById('password2');
        const form = document.querySelector('form');
        const submitBtn = document.getElementById('submit');
        
        password2.addEventListener('input', checkpassword);
        
        // Enhanced form submission
        form.addEventListener('submit', function(e) {
            // Check if passwords match before submitting
            const password1 = document.getElementById('password1').value;
            const password2 = document.getElementById('password2').value;
            
            if (password1 !== password2) {
                e.preventDefault();
                window.ProfessionalPlatform.showToastNotification('Passwords do not match!', 'error');
                return;
            }
            
            // Check age validation
            const dobInput = document.getElementById('date_of_birth');
            if (dobInput.value) {
                const dob = new Date(dobInput.value);
                const today = new Date();
                const age = today.getFullYear() - dob.getFullYear();
                const monthDiff = today.getMonth() - dob.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                
                if (age < 18) {
                    e.preventDefault();
                    window.ProfessionalPlatform.showToastNotification('You must be at least 18 years old to register.', 'error');
                    return;
                }
            }
            
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Account...';
            submitBtn.disabled = true;
        });
        
        // Enhanced real-time validation feedback
        const inputs = document.querySelectorAll('input[required], select[required]');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
            
            input.addEventListener('input', function() {
                if (this.classList.contains('is-invalid')) {
                    validateField(this);
                }
            });
        });
        
        // Username availability check (mock)
        const usernameField = document.getElementById('username');
        usernameField.addEventListener('blur', function() {
            if (this.value.length >= 3) {
                // Mock username check - in real app, make API call
                setTimeout(() => {
                    if (this.value.toLowerCase() === 'admin' || this.value.toLowerCase() === 'test') {
                        this.style.borderColor = 'var(--danger)';
                        showFieldError(this, 'Username already taken');
                    } else {
                        this.style.borderColor = 'var(--success)';
                        removeFieldError(this);
                    }
                }, 500);
            }
        });
        
        // Phone number formatting
        const phoneField = document.getElementById('contact_number');
        phoneField.addEventListener('input', function() {
            // Remove non-digits
            this.value = this.value.replace(/\D/g, '');
            // Limit to 10 digits
            if (this.value.length > 10) {
                this.value = this.value.substring(0, 10);
            }
        });
        
        // Initialize feature card animations
        const featureCards = document.querySelectorAll('.professional-feature-card');
        featureCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 200 + (index * 200));
        });
    });
    
    // Field validation helper
    function validateField(field) {
        const isValid = field.checkValidity() && field.value.trim() !== '';
        
        field.classList.remove('is-valid', 'is-invalid');
        
        if (field.value.trim() !== '') {
            if (isValid) {
                field.classList.add('is-valid');
                field.style.borderColor = 'var(--success)';
                removeFieldError(field);
            } else {
                field.classList.add('is-invalid');
                field.style.borderColor = 'var(--danger)';
                showFieldError(field, field.validationMessage);
            }
        }
    }
    
    function showFieldError(field, message) {
        removeFieldError(field);
        const errorDiv = document.createElement('div');
        errorDiv.className = 'field-error text-danger';
        errorDiv.style.fontSize = '0.875rem';
        errorDiv.style.marginTop = '0.25rem';
        errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle me-1"></i>${message}`;
        field.parentNode.appendChild(errorDiv);
    }
    
    function removeFieldError(field) {
        const existingError = field.parentNode.querySelector('.field-error');
        if (existingError) {
            existingError.remove();
        }
    }
</script>
{% endblock %}
